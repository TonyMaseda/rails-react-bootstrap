<section class="mt-0 mb-5 text-center">
  <div class="row">
    <div class="col-lg-7">
      <div class="row mb-3">
        <div class="col-12 mt-3 text-left">
          <%= render partial: 'users/users' %>
        </div><!-- .col-12 -->
        <%= render partial: 'pages/pies' %>
      </div><!-- .row .mb-5 -->
    </div><!-- .col-lg-7 -->
    <div class="col-lg-1 pb-1"></div>
    <div class="col-lg-4">
      <%= render partial: 'pages/columns' %>
    </div><!-- .col-lg-4 -->
  </div><!-- .row -->
  <!-- Google Charts -->
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <div class="row">
    <div class="col-md-9 mt-1 mb-4">
      <%= area_chart api_v1_charts_month_of_year_visits_path, refresh: 1200, download: {background: "#ffffff"}, points: false, colors: ["rgba(0,0,0,0.7)"], title: "Visits" %>
    </div><!-- .col-md-9 -->
    <div class="col-md-3 mt-1 mb-4">
      <script>
        google.charts.load('current', {'packages':['gauge']});
        google.charts.setOnLoadCallback(drawGauge);

        var gaugeOptions = {min: 0, max: 10000, yellowFrom: 7000, yellowTo: 8500,
          redFrom: 8500, redTo: 10000, minorTicks: 100};
        var gauge;

        function drawGauge() {
          gaugeData = new google.visualization.DataTable();
          gaugeData.addColumn('number', 'Visits');
          gaugeData.addRows(1);
          gaugeData.setCell(0, 0, <%= Ahoy::Visit.count %>);

          gauge = new google.visualization.Gauge(document.getElementById('gauge_div_1'));
          gauge.draw(gaugeData, gaugeOptions);
        }
      </script>
      <div id="gauge_div_1" class="pt-3 pb-5 mb-5"></div>
    </div><!-- .col-md-3 -->
    <div class="col-md-9 mt-1 mb-4">
      <%= area_chart api_v1_charts_month_of_year_visit_events_path, refresh: 1200, download: {background: "#ffffff"}, points: false, colors: ["rgba(0,0,0,0.3)"], title: "Visit Events" %>
    </div><!-- .col-md-9 -->
    <div class="col-md-3 mt-1 mb-4">
      <script>
        google.charts.load('current', {'packages':['gauge']});
        google.charts.setOnLoadCallback(drawGauge);

        var gaugeOptions = {min: 0, max: 100000, yellowFrom: 70000, yellowTo: 85000,
          redFrom: 85000, redTo: 100000, minorTicks: 1000};
        var gauge;

        function drawGauge() {
          gaugeData = new google.visualization.DataTable();
          gaugeData.addColumn('number', 'Events');
          gaugeData.addRows(1);
          gaugeData.setCell(0, 0, <%= Ahoy::Event.count %>);

          gauge = new google.visualization.Gauge(document.getElementById('gauge_div_2'));
          gauge.draw(gaugeData, gaugeOptions);
        }
      </script>
      <div id="gauge_div_2" class="pt-3 pb-5 mb-5"></div>
    </div><!-- .col-md-3 -->

    <div class="col-12 mt-1 mb-4">
      <script type="text/javascript">
        google.charts.load("current", {
          "packages":["map"],
          "mapsApiKey": "<%= "#{ENV['GEOCODER_API']}" %>"
        });
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
          var data = google.visualization.arrayToDataTable([
            ['Lat', 'Long', 'Location'],

            <% @visits.each do |visit| %>
              [<%= visit.latitude %>, <%= visit.longitude %>, '<%= "#{visit.location}" %>'],
            <% end %>

          ]);

          var map = new google.visualization.Map(document.getElementById('map_div'));
          map.draw(data, {
            showTooltip: true,
            showInfoWindow: true
          });
        }
      </script>
      <div id="map_div"></div>
    </div><!-- .col-12 .mt-1 .mb-4 -->

    <%= render partial: 'pages/donuts' %>
    <%= render partial: 'pages/bars' %>
    <%= render partial: 'pages/areas' %>
    <%= render partial: 'pages/lines' %>
  </div><!-- .row -->
</section><!-- .mt-0 .mb-5 .text-center -->

<section class="jumbotron mt-0 mb-5 text-center">
  <h4 class="jumbotron-heading mb-0 pb-0 text-orange">Article Word Tree</h4>
  <script type="text/javascript">
    google.charts.load('current', {packages:['wordtree']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable(
        [ ['Phrases'],
          <% @articles.each do |article| %>
            ['<%= "#{article.text.to_plain_text.gsub!(/[^0-9A-Za-z!@%&"()]/, ' ')}" %>'],
          <% end %>
          ['fooBar'],
        ]
      );

      var options = {
        maxFontSize: 20,
        wordtree: {
          format: 'implicit',
          word: 'Seed article',
          fontName: 'Times-Roman',
          colors: ['red', 'black', 'green'],
          backgroundColor: '#fff'
        }
      };

      var chart = new google.visualization.WordTree(document.getElementById('wordtree_basic'));
      chart.draw(data, options);
    }
  </script>

  <div id="wordtree_basic"></div>

</section><!-- .jumbotron .mt-0 .mb-5 .text-center -->
